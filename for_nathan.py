import requests
from math import nan
import pandas as pd


def word_count(s: str):
    if type(s) == float:  # if this value is missing
        return 0
    return len(s.split())  # a blank string will return 1 word. This is fine.


def nan_string(s):  # returns '' if the value is not a string.
    if type(s) == str:
        return s
    return ''


# this function will sort the dataframe, then put into the appropriate format.
def convert_dataframe_to_json(df: pd.DataFrame):
    df.sort_values(['publish_datetime'], inplace=True, ignore_index=True)

    json_obj = []
    for idx, article in df.iterrows():
        json_obj.append({
            'publish_datetime': article['publish_datetime'],
            'author': article['author'],
            'sentiment_score': article['sentiment_score'],
            'sector': article['sector'],

            'category': nan_string(article['category']),
            'sub_category': nan_string(article['sub_category']),
            'tags': nan_string(article['tags']),

            'title_word_count': word_count(article['article_title'], ),
            'summary_word_count': word_count(article['article_summary']),
            'article_word_count': word_count(article['article_content']),

        })
    return json_obj


if __name__ == '__main__':
    # below I am loading in an example dataframe, in the same format as the database you provided.
    # Change this to the dataframe you want.
    # There should be one dataframe per day.
    example_dataframe = pd.DataFrame([['2020-12-15 18:22:00+00', 'Robert Guy',
                                       "China's boom a high stakes game for Australia", nan,
                                       'As China continues to unashamedly slap Australia around on trade, there\'s one number policymakers need to keep in mind: 12 per cent. That\'s how much bigger Westpac calculates China\'s economy will be at the end of 2021 compared to the end of 2019, a wake-up call for Australian policymakers increasingly alarmed by Beijing\'s willingness to exploit its privileged role as the primary driver of global economic growth - and gatekeeper to the world\'s biggest consumer market - as a tool of coercion. China will enjoy a massive relative growth advantage over the West\'s major economies in 2021, with November\'s key economic data underscoring the momentum that will allow it to close the gap on the US and deliver the headline growth numbers Beijing\'s political elite desire in a year marking the 100th anniversary of the Chinese Communist Party. China\'s industrial production increased by 7 per cent year-on-year in November, up from 6.9 per cent in October, as the nation\'s exports machine went into overdrive. Other resource-intensive gauges of growth also ticked higher. Fixed asset investment, or spending on infrastructure, rose 2.6 per cent in the year to November compared to 1.8 per cent in the prior month.Property investment has increased 6.8 per cent in the year to date, compared to 6.3 per cent in October. Little wonder iron ore has traded at seven-year highs. Meanwhile, retail sales rose 5 per cent year-on-year compared to 4.3 per cent in October, a sign that domestic consumption is finally regaining its footing. That\'s a lot of dairy products, wine, grains and meat being consumed. These are an impressive set of numbers, a point unlikely to be lost on Canberra and those businesses that have profited handsomely from a relationship built on being a preferred supplier of rocks and crops to China. But Prime Minister Scott Morrison finds himself between rocks - and the export thereof - and the hard place of defending Australia\'s political and democratic sovereignty against Beijing\'s wolf warriors well aware of Australia\'s soft economic underbelly. The yet-to-be-confirmed ban on Australian coal testifies to Bejing\'s increasingly deft manipulation of the pain points in the trade relationship. While coal is on the nose among green activists, by JPMorgan\'s arithmetic Australia\'s coal shipments to China are equivalent to one percentage point of annual gross domestic product. JPMorgan\'s economics team diplomatically lamented the coal ban had "non-trivial implications" for Australia’s growth outlook. In other words, Beijing is playing for keeps. It has gradually notched up the pain factor by targeting soft commodities - barley, beef and wine - as it\'s climbed the rankings of major exports to eventually embrace coal as a cudgel against the Australian government. Iron ore is obviously the next target, a move that would seriously hurt Australia\'s economic recovery and the flow of cash into the nation\'s coffers. With BHP, Rio Tinto and Fortescue Metals Group accounting for an 11 per cent weighting in the S&P/ASX 200 Index, any halt to Australian iron ore imports would deliver a jarring blow to the market, and retirement savings. The Australian dollar would be torched should China choose the nuclear option. Fortunately, China has less flexibility on this front given the much-needed rebound in its economy - manifested in the strong demand from Chinese steel mills - and supply problems in rival supplier Brazil. While China\'s peak steel-making body jumps up and down about the need for a crackdown on iron ore prices, it\'s not like Chinese steel makers are starving. The reality is that East Asia blast furnace margins are around $US250 a tonne as finished steel prices are being supported by the economic recovery. That\'s the same recovery stoked by Beijing\'s choice of stimulus, while the boom in iron ore prices reflects the resource vulnerabilities of China\'s economic model and the enthusiasm Chinese punters have for trading iron ore futures on the Dalian Commodities Exchange. Frankly, China\'s steel mills can complain all they like, but they\'re just going to have to suck it up in the short term. The vision of resource security promised by the Xi administration\'s "dual circulation" development plan is a distant dream. While suggestions of an iron ore levy are needlessly incendiary, the dynamics at play in the global market are a reminder to Beijing that power imbalances can work both ways.',
                                       0.162, 'Markets', 'Equity Markets', 'Trade wars',
                                       'Trade wars, Analysis, Iron ore, Commodities, China relations, China',
                                       '2020-12-15 08:18:00', '2020-12-15 19:18:00+00'],
                                      ['2020-12-15 18:16:00+00', 'Jeremy Barr',
                                       "Newsmax and One America grapple uneasily with Biden's win", nan,
                                       'Washington | For the past six weeks, two upstart cable news channels – Newsmax and One America News – have tried to outflank Fox News from the right by embracing Donald Trump\'s strategy of election denialism. But on Monday (Tuesday AEDT), as the electoral college sealed Democrat Joe Biden\'s victory, their paths seemed to diverge slightly. John Bachman, who anchors an afternoon show on Newsmax, the larger of the two channels, referred to Mr Biden as the President-elect and noted that Mr Trump\'s legal challenges of the election results had failed at almost every step. "What I\'m trying to do is manage everyone\'s expectations," Mr Bachman told viewers. "These judges don\'t seem to be taking up these cases. This is the reality. This is the motion set in place." Yet OAN, the smaller of the two channels, virtually ignored the unfolding developments as electors cast their votes, instead devoting about four hours of daytime programming to a live feed of a hearing by the Arizona Senate to address voting procedures. Its 4pm news roundup failed to mention the electoral college vote at all.Newsmax hopes conservative anger at Fox News and a few Trump tweets can boost the much smaller network. And on Newsmax\'s American Agenda, which followed Mr Bachman\'s show, host Bob Sellers seemed to treat Mr Biden\'s victory as an unsettled issue, saying that people were "waiting with bated breath" for the results of the process and asserting that "there are still some outstanding cases of irregularity". James Renacci, a Republican former congressman from Ohio, appeared on Mr Sellers\' show and talked up the possibility that a member of the House of Representatives and US Senate could file a written objection to the certification process during a joint session on January 6 to finalise the results. About 5:30 pm (10:30am Tuesday AEDT), CNN and MSNBC declared in on-screen graphics that Mr Biden had reached the 270-vote threshold to be confirmed as president. Around the same time, a guest on Newsmax talked about alternative slates of electors meeting and said: "I think we\'ve still got several weeks here for this thing to play out." During one segment, when Washington Times writer Tim Constantine criticised the President and his team for continuing to argue that the election was fraudulent without sufficient evidence, in a bid to stay politically relevant, Mr Sellers gently chastised him: "Tim, it\'s kind of strange that you say that." Newsmax has seen substantial gains in its still-small ratings since the election. Nielsen, the viewership-measuring company, does not monitor OAN\'s ratings, although most industry experts estimate that they are a fraction of its more-established cable-news competition. While other cable channels, including CNN and MSNBC, kept tabs on the vote as it emerged through the day, occasionally featuring videos of electors meeting in their state capitals, OAN stuck to the Arizona hearing. Its 4pm news update led with a service outage by Google and YouTube, followed later by reports about one of Trump\'s angry tweets about the election and the weekend march in Washington by pro-Trump demonstrators. Conservative attorneys Victoria Toensing and Joseph diGenova, who have represented the Trump team in some of their election challenges, made an appearance on Newsmax. "How can you certify an election with all this fraud going on?" Ms Toensing asked rhetorically. There have been no substantiated claims of organised fraud on a scale to affect the results in any state. Mr DiGenova hyped the release of an audit conducted by a group called Allied Security Operations Group that focused on the performance of Dominion Voting System machines in one particular country in Michigan and accused the company of fraud. No such claims have been substantiated, and Dominion has denied all accusations of wrongdoing. "There will be a lot discussed about this over the next 24 hours," Mr diGenova predicted. As a caveat, Ms Toensing added: "Maybe only on Newsmax." Washington Post',
                                       -0.156, 'Companies', 'Media And Marketing', 'US votes 2020',
                                       "US votes 2020, Donald Trump, Trump's America, Joe Biden",
                                       '2020-12-15 08:18:00', '2020-12-15 19:18:00+00'],
                                      ['2020-12-15 17:39:00+00', 'Angus Grigg',
                                       "Land's swift recovery from drought amazes farmers", nan,
                                       'It has been almost a year since the rain finally came for brothers Simon and Cameron Wood at their family property in northern NSW, and they can’t believe how well the land and livestock have responded. After three years of crippling drought they were worried the seed bank may have been destroyed at their 4000-acre (1600-hectare) sheep and cattle property near the historic village of Uralla. “We have been amazed at how well the country has come back,” said younger brother Cameron. “The grass cover returned in three to four weeks [after the first rain].” As widespread rain once again fell across the New England region and much of the Australian east coast on Tuesday, the brothers are well into the task of rebuilding the farm, which has been in the family for six generations. “We are a long way behind where we should be,” said 38-year-old Simon.The surprisingly rapid regeneration of their pastures has allowed a gradual return to more normal grazing patterns over the past year, after spending up to $20,000 a week feeding stock during the drought. But the task of rebuilding their herd will take far longer. They are running about 75 per cent of their typical sheep flock and half their usual herd of cattle, despite abundant feed after good rainfall for much of the year. “We sold the last of our breeding cattle two weeks before it rained [a year ago],” said Simon. They kept 120 heifers (young females) and this will be the base from which they rebuild their cattle herd. Their sheep flock has bounced back more quickly, thanks to surprisingly strong lambing rates this spring. In 2019, in the final throes of one of the worst droughts to hit the New England region, known for its temperate climate and reliable rainfall, they had a lambing rate of just 16 per cent. “It was very depressing,” said Simon. “The mothers gave birth and just walked away from their lambs. I counted 86 dead lambs in one afternoon. It’s just a survival instinct for the mothers ... they knew they couldn’t raise their young.” This year could not be more different. The lambing rate was among the best on record, at 94 per cent with a high proportion of twins. And while wool prices have been hit by reduced demand for suits and trousers, as much of the world works from home during the COVID-19 pandemic, lamb and beef prices remain strong. “Two of our three commodities are doing well,” said Simon. Lamb prices were at record levels for much of the year and the peak body, Meat & Livestock Australia, expects prices to remain at “historically high levels” into 2021. It is the same story for beef, despite trade restrictions from China, with MLA forecasting prices to remain at “record levels” as farmers rebuild their herds and demand remains strong. It is a very different story from just 12 months ago. “On some days we couldn’t see the sheep from the dust,” said 35-year-old Cameron. “The whole property was just dirt.” And when the rain finally came on Christmas Eve 2019, it was such an unusual sight the brothers weren’t even sure what they were looking at. “I remember driving across the paddock after feeding the sheep and I could see a sort of shimmering in the distance and I had no idea what it was,” said Simon. He was looking at a neighbour’s dam, which had filled up with the run-off from a nearby hill, a sight they hadn’t seen in three years. “The drought definitely made us better farmers,” said Simon. “And through it all there was not a day when I woke up and wished I was working in an office.”',
                                       0.153, 'Companies', 'Agriculture', 'Farming',
                                       'Farming, Drought, Agriculture, Rural property',
                                       '2020-12-15 08:28:00', '2020-12-15 19:28:00+00'],
                                      ['2020-12-15 17:38:00+00', 'Michael Roddan',
                                       "Regulators give 'choice' super an ultimatum", nan,
                                       'Underperforming funds and fee gouging in the $900 billion "choice" superannuation sector run by banks and retail wealth managers will be targeted under new design and distribution obligations launched by the prudential regulator and the corporate watchdog. Super funds offering choice products – usually recommended by financial advisers – will have to prove the products are aimed at a target market and that the investment products actually serve the interests of those customers. In a letter to the industry on Tuesday, Australian Prudential Regulation Authority member Helen Rowell and Australian Securities and Investments Commission commissioner Danielle Press warned the sector to prepare for the government\'s new Member Outcomes performance assessments and the corporate regulator\'s new design and distribution obligations. The DDO is a long-awaited regulatory tool recommended by David Murray\'s 2014 financial system inquiry that will put the onus on companies to ensure their products and sales practices are fit for purpose, while the Member Outcomes obligations ensure funds are constantly reviewing their products and operations to deliver good outcomes for savers. While the $750 billion union and employer-backed industry fund sector has whinged about the Morrison government\'s new performance tests introduced in the October budget for only targeting the default MySuper sector, the new tools at ASIC and the APRA\'s disposal are set to clamp down on high-fee, low-performance retail funds.APRA has instructed retail funds to complete business performance reviews by the end of December, on which the regulator will score funds in early 2021. "The DDOs, which apply to [super trustees] in respect of their choice product offerings, require choice products to be designed for an identified target market of consumers, and require RSE (registrable superannuation entities) licensees to take reasonable steps in distribution that will, or are reasonably likely to, result in distribution to that target market," the letter said. APRA and ASIC said the new rules "seek to ensure the good governance of superannuation funds as a whole and the entire choice product lifecycle, from initial design and distribution through to monitoring, assessing and refining products". Super funds must make a target market determination for any choice products they offer from October 5 next year. There is now about 20,000 different investment choice products on the market and the rules are likely to trigger an intense wave of rationalisation of low-value products. The Member Outcomes rules will also require super funds to actively monitor the investment performance and returns provided to members in the choice options. "Both the Member Outcomes obligations and the DDOs require [trustees] to make business decisions based on the outcomes they are seeking to achieve for their members who hold the product," the letter said. The rules will also affect the provision of insurance in superannuation, where about two-thirds of Australians receive cover. On Monday, ASIC issued a report finding that Australians fork out more than $4.1 billion a year from their retirement savings for insurance, but value for money can be very hit and miss. In some cases, default premiums for a 30-year-old woman vary from $29 to $732 a year for similar coverage; while for a 50-year-old man the range is anywhere between $40 and $1480 a year. The lobby group for the industry fund sector, Industry Super Australia, this week complained that the government\'s new performance tests unveiled in the federal budget would unfairly target the default sector dominated by their funds, where the majority of mostly-unengaged members hold their savings. The test subjects default MySuper funds to an annual performance test that see them barred from accepting new members should they fail twice consecutively. The test as proposed by Treasury is based on a methodology that would benchmark funds in each asset class against a basket of 12 indices, with assumptions made on fees. Funds would need to be within 0.5 per cent of the benchmark to pass the test.',
                                       -0.024, 'Companies', 'Financial Services', 'Super wars',
                                       'Super wars, APRA', '2020-12-15 08:28:00',
                                       '2020-12-15 19:28:00+00'],
                                      ['2020-12-15 17:23:00+00', 'Michael Roddan',
                                       'AMP superannuation exec latest to jump ship', nan,
                                       'AMP head of superannuation Lara Bourguignon is the latest executive at the group to head for the exit as leadership ructions at the 171-year-old wealth manager continue into the new year. Ms Bourguignon will finish at the end of the year before moving to consulting, to be replaced on an interim basis by Ilaine Anderson, AMP\'s managing director of workplace superannuation. An AMP spokesman said Ms Bourguignon had made an important contribution to AMP over the past 2½ years. "We wish her all the best as she prepares to take on her next role," AMP said. Ms Bourguignon, who held a difficult job at a company that was subjected to numerous regulatory probes, worked under former AMP Australia chief executive Alex Wade. Mr Wade abruptly left AMP in August amid concerns about his performance and following allegations he had sent explicit photos to a female colleague.Later that month, recently promoted AMP Capital chief executive Boe Pahari was demoted following earlier revelations he had in 2018 settled a sexual harassment complaint brought by a female subordinate. That coincided with the resignations of AMP chairman David Murray and AMP Capital chairman John Fraser over the handling of the matter. Ms Bourguignon\'s departure, which had been the subject of rumours inside the business for a number of weeks, comes shortly after former Sunsuper boss Scott Hartley was picked as the new chief executive of AMP Australia. The appointment of the industry fund veteran came hot on the heels of fellow industry fund stalwart and former Cbus chief executive David Atkin being chosen as the new deputy chief of AMP Capital. While new chairman Debra Hazelton has put AMP on the sale block, chief executive Francesco De Ferrari is continuing to pursue his strategy. Ms Bourguignon recently appeared with Mr De Ferrari at a parliamentary hearing, which was ostensibly organised to probe the company\'s superannuation offerings but focused on AMP\'s treatment of Julia Szlakowski, who had made the complaint against Mr Pahari in 2017 and subsequently left the business. Before joining AMP, Ms Bourguignon spent nearly two decades working for National Australia Bank and its wealth management arm MLC. AMP has suffered an exodus of staff following revelations by The Australian Financial Review that it promoted Mr Pahari despite the alleged harassment settlement. In September, Mr De Ferrari warned employees of widespread redundancies in AMP\'s corporate division. Sources suggested job cuts of up to 20 per cent in certain divisions could follow. AMP Capital is pivoting to a focus on private markets.',
                                       -0.329, 'Companies', 'Financial Services', 'Executive shake-up',
                                       'Executive shake-up, AMP, SunSuper, Cbus, Francesco De Ferrari, National Australia Bank',
                                       '2020-12-15 08:28:00', '2020-12-15 19:28:00+00']],
                                     columns=['publish_datetime', 'author', 'article_title', 'article_summary',
                                              'article_content', 'sentiment_score', 'sector', 'category',
                                              'sub_category', 'tags', 'date_time_utc', 'date_time_aest'])

    # this function will sort the dataframe, then put into the appropriate format.
    obj_to_send = convert_dataframe_to_json(example_dataframe)

    # ex2 url
    url = 'http://ec2-18-221-204-134.us-east-2.compute.amazonaws.com/get_prediction'

    response = requests.post(url, json=obj_to_send)  # sending to server

    predictions = response.json()['prediction']  # time series predictions
    latest_prediction = predictions[-1]  # latest prediction
    print(latest_prediction)
